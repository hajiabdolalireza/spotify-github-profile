{% set W = W or 920 %}
{% set ROW_H = 88 %}
{% set PAD_X = 28 %}
{% set PAD_Y = 24 %}
{% set R = 18 %}
{% set TITLE_SPOTIFY = 26 %}
{% set TITLE_RP = 26 %}
{% set TRACK_SIZE = 22 %}
{% set ARTIST_SIZE = 18 %}
{% set TIME_SIZE = 16 %}
{% set ROWS = items|length %}
{% set H = PAD_Y*2 + 48 + ROWS*ROW_H %}

<svg xmlns="http://www.w3.org/2000/svg" width="{{ W }}" height="{{ H }}" viewBox="0 0 {{ W }} {{ H }}" role="img" aria-label="Spotify Recently Played">
  <defs>
    <style>
      .card  { fill:#171A1C; }
      .tSpot { fill:#1DB954; font: {{ TITLE_SPOTIFY }}px/1.2 -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:800; }
      .tHead { fill:#EDEFF1;     font: {{ TITLE_RP }}px/1.2       -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:800; }
      .track { fill:#F4F6F8;     font: {{ TRACK_SIZE }}px/1.25    -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:800; }
      .artist{ fill:#A7AFB8;     font: {{ ARTIST_SIZE }}px/1.35   -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:600; }
      .time  { fill:#9AA3AE;     font: {{ TIME_SIZE }}px/1        -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; text-anchor:end; }
      .sep   { stroke:#2B2F33; stroke-width:1; opacity:.9; }
      .logo  { fill:#1DB954; }
    </style>
    <clipPath id="cover"><rect rx="8" ry="8" width="56" height="56"/></clipPath>
  </defs>

  <rect x="0" y="0" width="{{ W }}" height="{{ H }}" rx="{{ R }}" ry="{{ R }}" class="card"/>

  <g transform="translate({{ PAD_X }}, {{ PAD_Y }})">
    <svg x="0" y="0" width="36" height="36" viewBox="0 0 60 60" aria-hidden="true">
      <path fill="#1DB954" d="M30 15c8.28 0 15 6.72 15 15s-6.72 15-15 15S15 38.28 15 30 21.72 15 30 15zm6.77 22.25a1.88 1.88 0 0 0-2.58-.63c-3.04 1.86-6.87 2.28-11.38 1.24a1.88 1.88 0 1 0-.82 3.65c5.30 1.19 9.77.67 13.30-1.53.83-.51 1.08-1.6.48-2.73zm1.52-6.18a2.25 2.25 0 0 0-3.10-.76c-3.54 2.16-8.95 2.80-15.03 1.53a2.25 2.25 0 0 0-.93 4.40c7.00 1.48 13.31.74 17.72-1.94a2.25 2.25 0 0 0 .34-3.23zm.38-6.26a2.63 2.63 0 0 0-3.62-.88c-3.97 2.43-10.61 3.23-17.77 1.76a2.63 2.63 0 1 0-1.09 5.14c8.09 1.71 15.78.85 20.90-2.23a2.63 2.63 0 0 0 .58-3.79z"/>
    </svg>
    <text x="64" y="30" class="tSpot">Spotify</text>
    <text x="184" y="30" class="tHead">Recently Played</text>
  </g>

  <line x1="0" x2="{{ W }}" y1="{{ PAD_Y + 50 }}" y2="{{ PAD_Y + 50 }}" class="sep"/>

  {% for it in items %}
    {% set y = PAD_Y + 50 + (loop.index0 * ROW_H) %}
    <g transform="translate({{ PAD_X }}, {{ y }})">
      {% if it.cover %}
        <image href="{{ it.cover }}" x="0" y="16" width="56" height="56" preserveAspectRatio="xMidYMid slice" clip-path="url(#cover)"/>
      {% else %}
        <rect x="0" y="16" width="56" height="56" rx="8" ry="8" fill="#2B2F33"/>
      {% endif %}
      <text x="76" y="44" class="track">{{ it.title }}</text>
      <text x="76" y="68" class="artist">{{ it.artist }}</text>
      <text x="{{ W - PAD_X }}" y="52" class="time">{{ it.when }}</text>
    </g>
    {% if not loop.last %}
      <line x1="{{ PAD_X }}" x2="{{ W - PAD_X }}" y1="{{ y + ROW_H }}" y2="{{ y + ROW_H }}" class="sep"/>
    {% endif %}
  {% endfor %}
</svg>
