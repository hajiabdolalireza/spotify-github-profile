{% set W = W or 920 %}
{% set ROW_H = 88 %}
{% set PAD_X = 28 %}
{% set PAD_Y = 24 %}
{% set R = 18 %}
{% set TITLE_SPOTIFY = 26 %}
{% set TITLE_RP = 26 %}
{% set TRACK_SIZE = 22 %}
{% set ARTIST_SIZE = 18 %}
{% set TIME_SIZE = 16 %}
{% set ROWS = items|length %}
{% set H = PAD_Y*2 + 48 + ROWS*ROW_H %}

<svg xmlns="http://www.w3.org/2000/svg" width="{{ W }}" height="{{ H }}" viewBox="0 0 {{ W }} {{ H }}" role="img" aria-label="Spotify Recently Played">
  <defs>
    <style>
      .card  { fill:#171A1C; }
      .tSpot { fill:#1DB954; font: {{ TITLE_SPOTIFY }}px/1.2 -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:800; }
      .tHead { fill:#EDEFF1;     font: {{ TITLE_RP }}px/1.2       -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:800; }
      .track { fill:#F4F6F8;     font: {{ TRACK_SIZE }}px/1.25    -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:800; }
      .artist{ fill:#A7AFB8;     font: {{ ARTIST_SIZE }}px/1.35   -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:600; }
      .time  { fill:#9AA3AE;     font: {{ TIME_SIZE }}px/1        -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; text-anchor:end; }
      .sep   { stroke:#2B2F33; stroke-width:1; opacity:.9; }
      .logo  { fill:#1DB954; }
    </style>
    <clipPath id="cover"><rect rx="8" ry="8" width="56" height="56"/></clipPath>
  </defs>

  <rect x="0" y="0" width="{{ W }}" height="{{ H }}" rx="{{ R }}" ry="{{ R }}" class="card"/>

  <!-- Header -->
  <g transform="translate(24,28)">
    <!-- Official Spotify glyph, crisp via viewBox (24x24) -->
    <svg x="0" y="0" width="28" height="28" viewBox="0 0 24 24" role="img" aria-label="Spotify">
      <path fill="#1DB954" d="M12 1.5C6.21 1.5 1.5 6.21 1.5 12S6.21 22.5 12 22.5 22.5 17.79 22.5 12 17.79 1.5 12 1.5zm5.21 15.24c-.19.31-.59.41-.9.22-2.47-1.51-5.58-1.85-9.24-1-.36.08-.72-.15-.81-.51-.08-.36.15-.72.51-.81 3.96-.9 7.36-.51 10.08 1.15.32.19.42.59.23.9zm1.25-2.8c-.24.38-.75.5-1.14.26-2.82-1.73-7.11-2.24-10.44-1.21-.43.13-.88-.12-1.01-.55-.13-.43.12-.88.55-1.01 3.8-1.15 8.52-.58 11.73 1.35.39.24.51.75.26 1.14zm.11-2.93c-.28.45-.87.6-1.33.32-3.22-1.92-8.14-2.1-11.06-1.14-.5.16-1.03-.12-1.19-.62-.16-.5.12-1.03.62-1.19 3.35-1.05 8.77-.83 12.42 1.31.46.27.61.87.33 1.33z"/>
    </svg>
    <text x="44" y="22" fill="#FFFFFF" font-size="22" font-weight="700"
          font-family='-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif'>
      Spotify
    </text>
    <text x="44" y="46" fill="#FFFFFF" opacity="0.85" font-size="22" font-weight="600"
          font-family='-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif'>
      Recently Played
    </text>
  </g>

  <line x1="0" x2="{{ W }}" y1="{{ PAD_Y + 50 }}" y2="{{ PAD_Y + 50 }}" class="sep"/>

  {% for it in items %}
    {% set y = PAD_Y + 50 + (loop.index0 * ROW_H) %}
    <g transform="translate({{ PAD_X }}, {{ y }})">
      {% if it.cover %}
        <image href="{{ it.cover }}" x="0" y="16" width="56" height="56" preserveAspectRatio="xMidYMid slice" clip-path="url(#cover)"/>
      {% else %}
        <rect x="0" y="16" width="56" height="56" rx="8" ry="8" fill="#2B2F33"/>
      {% endif %}
      <text x="76" y="44" class="track">{{ it.title }}</text>
      <text x="76" y="68" class="artist">{{ it.artist }}</text>
      <text x="{{ W - PAD_X }}" y="52" class="time">{{ it.when }}</text>
    </g>
    {% if not loop.last %}
      <line x1="{{ PAD_X }}" x2="{{ W - PAD_X }}" y1="{{ y + ROW_H }}" y2="{{ y + ROW_H }}" class="sep"/>
    {% endif %}
  {% endfor %}
</svg>
