{% set W = W or 920 %}
{% set ROW_H = 88 %}
{% set PAD_X = 28 %}
{% set PAD_Y = 24 %}
{% set R = 18 %}
{% set TITLE_SPOTIFY = 26 %}
{% set TITLE_RP = 26 %}
{% set TRACK_SIZE = 22 %}
{% set ARTIST_SIZE = 18 %}
{% set TIME_SIZE = 16 %}
{% set ROWS = items|length %}
{% set H = PAD_Y*2 + 48 + ROWS*ROW_H %}

<svg xmlns="http://www.w3.org/2000/svg" width="{{ W }}" height="{{ H }}" viewBox="0 0 {{ W }} {{ H }}" role="img" aria-label="Spotify Recently Played">
  <defs>
    <style>
      .card  { fill:#171A1C; }
      .tSpot { fill:#1DB954; font: {{ TITLE_SPOTIFY }}px/1.2 -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:800; }
      .tHead { fill:#EDEFF1;     font: {{ TITLE_RP }}px/1.2       -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:800; }
      .track { fill:#F4F6F8;     font: {{ TRACK_SIZE }}px/1.25    -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:800; }
      .artist{ fill:#A7AFB8;     font: {{ ARTIST_SIZE }}px/1.35   -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; font-weight:600; }
      .time  { fill:#9AA3AE;     font: {{ TIME_SIZE }}px/1        -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,"Helvetica Neue",sans-serif; text-anchor:end; }
      .sep   { stroke:#2B2F33; stroke-width:1; opacity:.9; }
      .logo  { fill:#1DB954; }
    </style>
    <clipPath id="cover"><rect rx="8" ry="8" width="56" height="56"/></clipPath>
  </defs>

  <rect x="0" y="0" width="{{ W }}" height="{{ H }}" rx="{{ R }}" ry="{{ R }}" class="card"/>

  <g transform="translate({{ PAD_X }}, {{ PAD_Y }})">
    <svg x="0" y="0" width="36" height="36" viewBox="0 0 24 24" aria-hidden="true">
      <path fill="#1DB954" d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.45 17.4c-.23.38-.71.5-1.09.27-3.01-1.82-6.8-2.24-11.26-1.21-.43.1-.87-.18-.97-.61-.1-.43.18-.87.61-.97 4.8-1.12 9-.65 12.4 1.33.38.23.5.71.31 1.19zm1.55-3.5c-.29.47-.9.62-1.37.33-3.44-2.12-8.67-2.74-12.72-1.49-.53.16-1.09-.15-1.24-.68-.16-.53.15-1.09.68-1.24 4.6-1.31 10.35-.65 14.31 1.67.47.29.62.9.33 1.37zm.11-3.73c-.35.56-1.09.73-1.65.38-3.87-2.35-10.26-2.91-15-.64-.6.21-1.24-.12-1.45-.72-.21-.6.12-1.24.72-1.45 5.52-1.92 12.56-1.31 17 .91.56.35.73 1.09.38 1.65z"/>
    </svg>
    <text x="64" y="30" class="tSpot">Spotify</text>
    <text x="184" y="30" class="tHead">Recently Played</text>
  </g>

  <line x1="0" x2="{{ W }}" y1="{{ PAD_Y + 50 }}" y2="{{ PAD_Y + 50 }}" class="sep"/>

  {% for it in items %}
    {% set y = PAD_Y + 50 + (loop.index0 * ROW_H) %}
    <g transform="translate({{ PAD_X }}, {{ y }})">
      {% if it.cover %}
        <image href="{{ it.cover }}" x="0" y="16" width="56" height="56" preserveAspectRatio="xMidYMid slice" clip-path="url(#cover)"/>
      {% else %}
        <rect x="0" y="16" width="56" height="56" rx="8" ry="8" fill="#2B2F33"/>
      {% endif %}
      <text x="76" y="44" class="track">{{ it.title }}</text>
      <text x="76" y="68" class="artist">{{ it.artist }}</text>
      <text x="{{ W - PAD_X }}" y="52" class="time">{{ it.when }}</text>
    </g>
    {% if not loop.last %}
      <line x1="{{ PAD_X }}" x2="{{ W - PAD_X }}" y1="{{ y + ROW_H }}" y2="{{ y + ROW_H }}" class="sep"/>
    {% endif %}
  {% endfor %}
</svg>
